<!doctype html>
<html lang="es">
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Configurar primer admin</title>
<link rel="stylesheet" href="assets/style.css">
</head>
<body>
<div class="container">
  <h2>Crear primer administrador</h2>
  <div id="msg" class="message"></div>
  <form id="f" class="form-grid">
    <input id="full_name" placeholder="Nombre completo" required>
    <input id="email" type="email" placeholder="Email (ej. epiblue@gmail.com)" required>
    <input id="password" type="password" placeholder="Contraseña (ej. Erucampo1.)" required>
    <select id="company"><option value="visionacademy">visionacademy</option><option value="eyecare">eyecare</option></select>
    <input id="position" value="Admin" required>
    <button>Crear primer admin</button>
  </form>
</div>
<script>
const msg=document.getElementById('msg');
const form=document.getElementById('f');

function showMessage(message, isSuccess = false) {
  msg.textContent = message;
  msg.className = 'message ' + (isSuccess ? 'success' : 'error');
}

form.addEventListener('submit', async (e)=>{
  e.preventDefault();
  showMessage('Creando…');
  const body = {
    full_name: form.full_name.value.trim(),
    email: form.email.value.trim(),
    password: form.password.value,
    company: form.company.value,
    position: form.position.value.trim()
  };
  try{
    const response = await fetch('/api/bootstrap_admin',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
    const data = await response.json();
    if (!response.ok) {
      if (response.status === 403) {
        throw new Error('Ya existe un administrador. Por seguridad, este formulario ha sido desactivado.');
        form.style.display = 'none';
      }
      throw new Error(data.error || 'Error desconocido');
    }
    showMessage('Creado ✓ Ahora borra admin-setup.html del repo.', true);
    form.style.display = 'none';
  }catch(err){
    showMessage('Error: ' + err.message);
  }
});
</script>
</body>
</html>
